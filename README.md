1. Структура задачи

С точки зрения утилиты в задаче есть следующие части

  * Тесты и ответы на тесты
Находятся в папке tests. Генерируемые файлы. Их не следует менять вручную.

  * Генераторы
Бывают трех типов. Stdout-генератор, File-генератор, Multi-генератор.
По умолчанию все генераторы считаются Stdout. Генераторы других типов
надо указывать явно. Находятся в папке src. Считается, что названия 
никаких двух генераторов не совпадают (без учета расширения).

  * Чекер
Файл check.{cpp,java} или Check.{cpp,java}. Может находиться в корне задачи 
или папке src. В случае, если чекер написан на java, нужно указать путь к 
testlib4j.jar. 

  * Валидатор
Файл validate.{cpp,java} или Validate.{cpp,java}. Может находиться в корне задачи 
или папке src.

  * Решения
Лежат в папке solutions. Название начиначется с имени задачи и подчеркивания.
Обращение к решению происходит по ShortName --- части имени решения
без имени задачи и расширения файла. Считается, что ShortName не совпадает ни у
каких двух решений, а так же не совпадает с названиями генераторов, чекера, 
валидатора. Поддерживются решения на C,C++,Java,Pascal,Delphi,Python.
Соответствующие расширения файлов .c,.cpp,.java,.pas,.dpr,.py.
В случае с Pascal-Delphi, если не удалось найти один компилятор,
то будет попытка скомпилировать другим. С мелкими изменениями
кода для совместимости. В частности при переходе Delphi->FPC,
добавляется строка {$mode delphi}. При обратном - все её
вхождения удаляются.
Python запускается как ./%solutionname%. Считается что все решения работают 
через stdin/stdout. Для этого можно использовать константу NOFILES определенную
дефолтными строкми компиляции или запуска. Либо можно явно указать,
что решение работает, используя файловый ввод-вывод,
записав его ShortName в переменную FileIOSol. В таком случае
все будет работать несколько медленнее из-за лишних операций
с файловой системой.

  * Градеры [необязатено]
Лежат в папке graders. Если она существует, то считается, что 
в задаче используются градеры. Тогда решения на java и python
не поддерживаются.

  * Строки генерации файлов.
Они должны генерироваться каким-либо исполняемым файлом в stdout.


2. Внутренние файлы и папки

  * .tests
Файл, содержащий строки генерации тестов.
Название можно переопределить в makefile задачи.
Генерируемый файл, его не следует менять руками.
Генерируется файлом genlines.sh по умолчанию.
Можно изменить на любой другой исполняемый файл.
Для этого надо перезаписать переменную GenLinesGenerator.
Соответствующий исполняемый файл должен выводить строки
генерации по одной в строке в stdout.

  * .config
Файл, содержащий подробную информацию о задаче.
Генерируемый файл, его не следует менять руками.
Автоматически обновляется при изменении
.tests или файла генерирующего его.
При пересоздании обновляются изменившиеся
флаги __temp__/%TEST%.gen

  * .bin
Папка содержащая исполняемые файлы.
Все генераторы запускаются из нее.
При использовании в makefile лучше обращаться к ней, как $(binDir)

  * .\_\_temp\_\_
Папка содержащая различные флаги.
При использовании в makefile лучше обращаться к ней, как $(tempDir)

  * .\_\_temp\_\_/%TEST%.gen 
Последняя строка генерации файла.

  * .\_\_temp\_\_/%TEST%.val
Флаг по которому определяется время последней валидации теста.


3. Команды

all                        сгенерировать все тесты и ответы, провалидировать тесты
inputs                     сгенерировать и провалидировать тесты
%ShortName%                скомпилировать решение
%GeneratorName%            cкомпилировать генератор
check                      скомпилировать чекер
validate                   скомпилировать валидатор
%Test%                     сгенерировать и провалидировать тест
%Test.a%                   сгенерировать ответ на тест. Проверить его чекером
check_%ShortName%          проверить решение. Не проверяет TL,ML.
check_%ShortName%@%Test%   проверить решение на тесте. Не проверяет TL,ML.
info%Test%                 вывести информацию о тесте. Включает в себя строку генерации и группу
info                       вывести информацию о всех тестах.
problemInfo                вывести информацию о задаче. Включает в себя информацию о значениях, которые могут быть установленны неявно.
wipe                       удалить все созданные файлы, кроме тестов и флагов в .__temp__
clean                      удалить все созданные файлы. Удаляет папку tests.
forceclean                 удалить все автоматически-генерируемые файлы. Включая тесты из условия, .config и .tests
md5sum                     cоздает файл tests.md5 содержащий md5sum тестов с Unix переводами строк.
md5check                   проверяет, что тесты соответствуют записанным в tests.md5 хешам, если они есть
reload                     принудительно пересобирает .config. Необходимо делать при появлении новых решений, без изменения тестов. 
                           Также может помочь, если происходит что-то странное. 

4. Конфигурация.

Параметр                                         Переменная              Значение по умолчанию
Название задачи                                  problem                 Название папки задачи
Суффикс главного решения                         mainSuffix              нет
Маска тестов                                     TestMask                %03d
Генератор файла со строками генерации тестов     GenLinesGenerator       dotests.sh
Файл со строками генерации                       GenLinesFile            .tests
Суффикс ручных тестов                            HandSuffix              hand
Путь к testlib4j                                 Testlib4jPath           ./src

Параметры компиляции и запуска
Компиляция Java                                  JAVACFLAGS
Запуск решений на Java                           JAVASOLFLAGS            -ea -Xmx256M -Xss128M -DNOFILES
Компиляция GCC                                   GCCFLAGS                -O2 -Wall -Wextra -Wconversion [ -Wl,--stack=256000000 для Windows ]
Дополнительные для компиляции решений GCC        GCCSOLFLAGS             -DNOFILES
Компиляция FPC                                   FPCFLAGS                -O2
Дополнительные для компиляции решений FPC        -dNOFILES               -DNOFILES
Компиляция DPR                                   DCCFLAGS                -cc
Дополнительные для компиляции решений DPR        DCCSOLFLAGS             -DNOFILES
Запуск решений на питоне                         PYTHONSOLFLAGS          NOFILES (передается, как параметр командной строки)


5. Чекер.

Ищестся на C++ или Java с названием check или Check.
Должен лежать в корне задачи или папке src.
Должен возвращать ненулевой код возврата в случае ошибки 
и нулевой в случае правильного ответа.
Если чекер не найден используеся diff, о чем выдается
предупреждение при reload.

6. Ручные тесты
Лежат в папке src, должны назваться %Test%.$(HandSuffix)
Если копируются командой cp, рассматриваются как тесты
с File генератором, в случае команды cat, как тесты
с Stdout генератором. Иначе в зависимости
от типа используемой дополнительной программы.

7. Группы тестов.
Для отделения групп тестов в файл .tests следует выводить
строку "\# NEW GROUP". Группы тестов нумеруются с нуля.
Номер группы будет передан как параметр командной строки 
валидатору, и может быть использован для различных дополнительных
проверок.


7. Stdout генераторы
Такие генераторы должны выводить тест в stdout.
Ими считаются, все файлы в src,
название которых начинается со слова gen,
а также twf.c, и указанные явно в переменной AdditionalStdoutGens.
Из этого списка исключаются генераторы с явно указанным другим типом.
Такие генераторы можно комбинировать через pipe при генрации одного теста.

8. File генераторы.
Должны быть явно указаны (ShortName) в перменной FileGenerators.
Должны генерировать нужный тест в файл с соответствующим названием.
Файл может создваваться в текущей дириктории или ../tests

9. Multi генераторы.
Должны быть явно указаны (ShortName) в перменной MultiGenerators.
Генерируют все свои тесты за один запуск. При этом используется строка
генерации первого из них. Должны генерировать нужные тесты в файл с 
соответствующим названием. Файлы могут создваваться в текущей дириктории
или ../tests

10. Автоматическая генерация тестов из условия.
Тесты и ответы на тесты перечисленные в переменной StatementFiles
будут копироваться в папку $(statementDir) (по умолчанию statement) 
при каждой команде "make all" или "make statement".
Их можно вставлять в условие с помощью verbatiminput.

11. Расширения.
В makefile задачи можно дописывать дополнительные зависимости.
Например таким способом в задачу можно добавить визуализатор.
Поддерживются следующие модификации режима работы основной системы.

OverrideTestRule - не определять правило генерации тестов.

OverrideTestAnswersRule - не определять правило генерации ответов.

NoAnswers - Считать, что в задаче нет ответов. Применимо к неточным задачам.

Для соответствующей модификации надо присвоить переменной значение 1.

При определении дополнительных исполняемых файлов следует использовать
переменную $(binDir) в качестве папки.
